<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Expenses App — Auth Wrapper</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Optional: your app might use Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-50 min-h-screen text-gray-800">
  <!-- Sign-in gate -->
  <section id="signinView" class="min-h-screen grid place-items-center">
    <div class="bg-white rounded-2xl shadow p-6 text-center">
      <h1 class="text-xl font-bold mb-1">Expenses</h1>
      <p class="text-sm text-gray-600 mb-4">Sign in with Google to continue</p>
      <button id="btnGoogle" class="px-4 py-2 rounded-lg bg-black text-white text-sm">Sign in with Google</button>
      <p id="signinMsg" class="text-xs text-gray-500 mt-3"></p>
    </div>
  </section>

  <!-- Your existing UI goes inside #appRoot -->
  <div id="appRoot" class="hidden">
 

  <!-- MAIN CONTAINER -->
  <div class="w-full max-w-sm mx-auto bg-white rounded-3xl shadow-lg mt-4 pb-24 relative">

    <!-- HEADER + חודש -->
    <div class="flex justify-between items-center px-4 pt-5 mb-1">
      <button onclick="prevMonth()" class="p-2 rounded-full bg-gray-100 text-2xl">&#8592;</button>
      <div class="text-center flex-1">
        <div id="month-title" class="text-lg font-bold tracking-widest"></div>
      </div>
      <button onclick="nextMonth()" class="p-2 rounded-full bg-gray-100 text-2xl">&#8594;</button>
    </div>

    <!-- SUMMARY SECTION -->
    <div class="flex justify-between px-6 mt-3 text-sm">
      <div class="flex flex-col items-center">
        <span class="text-gray-400">Income</span>
        <span class="text-green-600 font-bold text-lg" id="income-summary">₪ 0</span>
      </div>
      <div class="flex flex-col items-center">
        <span class="text-gray-400">Expense</span>
        <span class="text-red-500 font-bold text-lg" id="expense-summary">₪ 0</span>
      </div>
    </div>

    <!-- DONUT CHART -->
    <div class="flex justify-center items-center relative w-full my-2" style="height: 140px;">
      <canvas id="circle-chart" width="160" height="160" class="z-0"></canvas>
      <div class="absolute inset-0 flex flex-col items-center justify-center z-10 pointer-events-none">
        <span id="safe-to-spend" class="font-bold text-lg text-gray-800">₪ 0</span>
        <div class="text-xs text-gray-400 font-medium">נשאר להוציא</div>
        <div class="text-xs text-gray-400 mt-1" id="days-left">עוד 30 ימים</div>
      </div>
    </div>

   <!-- MONTH LIST BUTTON (replaces Recent Transactions) -->
<div class="px-4 mt-6">
  <button onclick="showList()" id="open-list-btn"
          class="w-full py-3 rounded-xl bg-gray-100 hover:bg-gray-200 font-semibold">
    כל ההכנסות וההוצאות לחודש
  </button>
</div>
<!-- מסך רשימת כל התנועות לחודש -->
<div id="screen-list" class="fixed inset-0 bg-white z-40 flex flex-col" style="display:none;">
  <div class="p-4 border-b flex items-center justify-between">
    <div class="font-bold" id="list-title">תנועות</div>
    <button class="text-blue-600" onclick="hideList()">סגור</button>
  </div>
  <div class="p-4 overflow-auto flex-1">
    <ul id="list-transactions" class="space-y-2"></ul>
  </div>
</div>


    <!-- FLOATING ACTION BUTTON -->
    <button onclick="showScreen('add')" class="fixed bottom-8 left-1/2 -translate-x-1/2 bg-blue-500 text-white rounded-full shadow-lg w-16 h-16 flex items-center justify-center text-3xl hover:bg-blue-600 transition-all z-30 border-4 border-white">
      +
    </button>
  </div>

  <!-- דף הוספה -->
  <div id="screen-add" class="fixed inset-0 bg-white z-40 flex flex-col items-center justify-center" style="display:none;">
    <form id="expense-form" class="w-full max-w-xs p-6 rounded-2xl shadow bg-white flex flex-col gap-3">
      <h2 class="text-lg font-bold mb-2 text-center">הוסף הוצאה/הכנסה</h2>
      <!-- TOGGLE -->
      <div class="flex items-center justify-center gap-0 mb-2">
        <button type="button" id="btn-expense" class="toggle-type px-5 py-2 rounded-l-xl font-bold bg-blue-100 text-blue-700 border border-blue-200">הוצאה</button>
        <button type="button" id="btn-income" class="toggle-type px-5 py-2 rounded-r-xl font-bold bg-gray-100 text-gray-400 border border-blue-200">הכנסה</button>
        <input type="hidden" name="type" id="type" value="expense">
      </div>
      <!-- CATEGORIES -->
      <div id="category-picker" class="grid grid-cols-4 gap-2 mb-3">
        <button type="button" class="cat-btn flex flex-col items-center p-2 rounded-xl border bg-gray-50 hover:bg-green-100" data-category="דלק">
          <span>⛽</span><span class="text-xs mt-1">דלק</span>
        </button>
        <button type="button" class="cat-btn flex flex-col items-center p-2 rounded-xl border bg-gray-50 hover:bg-green-100" data-category="רכב">
          <span>🚗</span><span class="text-xs mt-1">רכב</span>
        </button>
        <button type="button" class="cat-btn flex flex-col items-center p-2 rounded-xl border bg-gray-50 hover:bg-green-100" data-category="בית">
          <span>🏠</span><span class="text-xs mt-1">בית</span>
        </button>
        <button type="button" class="cat-btn flex flex-col items-center p-2 rounded-xl border bg-gray-50 hover:bg-green-100" data-category="סופר">
          <span>🛒</span><span class="text-xs mt-1">סופר</span>
        </button>
        <button type="button" class="cat-btn flex flex-col items-center p-2 rounded-xl border bg-gray-50 hover:bg-green-100" data-category="חשמל">
          <span>💡</span><span class="text-xs mt-1">חשמל</span>
        </button>
        <button type="button" class="cat-btn flex flex-col items-center p-2 rounded-xl border bg-gray-50 hover:bg-green-100" data-category="בתי ספר">
          <span>🏫</span><span class="text-xs mt-1">בתי ספר</span>
        </button>
        <button type="button" class="cat-btn flex flex-col items-center p-2 rounded-xl border bg-gray-50 hover:bg-green-100" data-category="חוגים">
          <span>🎵</span><span class="text-xs mt-1">חוגים</span>
        </button>
        <button type="button" class="cat-btn flex flex-col items-center p-2 rounded-xl border bg-gray-50 hover:bg-green-100" data-category="שטויות">
          <span>🎁</span><span class="text-xs mt-1">שטויות</span>
        </button>
        <button type="button" class="cat-btn flex flex-col items-center p-2 rounded-xl border bg-gray-50 hover:bg-green-100" data-category="מסעדות">
          <span>🍔</span><span class="text-xs mt-1">מסעדות</span>
        </button>
        <button type="button" class="cat-btn flex flex-col items-center p-2 rounded-xl border bg-gray-50 hover:bg-green-100" data-category="בגדים">
          <span>👕</span><span class="text-xs mt-1">בגדים</span>
        </button>
        <button type="button" class="cat-btn flex flex-col items-center p-2 rounded-xl border bg-gray-50 hover:bg-green-100" data-category="שונות">
          <span>✨</span><span class="text-xs mt-1">שונות</span>
        </button>
        <button type="button" class="cat-btn flex flex-col items-center p-2 rounded-xl border bg-gray-50 hover:bg-green-100" data-category="כספומט">
          <span>🏧</span><span class="text-xs mt-1">כספומט</span>
        </button>
        <button type="button" class="cat-btn flex flex-col items-center p-2 rounded-xl border bg-gray-50 hover:bg-green-100" data-category="ביטוח">
          <span>🛡️</span><span class="text-xs mt-1">ביטוח</span>
        </button>
        <button type="button" class="cat-btn flex flex-col items-center p-2 rounded-xl border bg-gray-50 hover:bg-green-100" data-category="חיות">
          <span>🐶</span><span class="text-xs mt-1">חיות</span>
        </button>
        <button type="button" class="cat-btn flex flex-col items-center p-2 rounded-xl border bg-gray-50 hover:bg-green-100" data-category="תרבות">
          <span>🎭</span><span class="text-xs mt-1">תרבות</span>
        </button>
      </div>
        <!-- סוג הוצאה -->
<div class="mt-1">
  <div class="text-sm font-semibold mb-1">סוג הוצאה</div>
  <div class="flex gap-2">
    <button type="button" class="mode-btn px-3 py-2 rounded-xl bg-blue-100 text-blue-700 border border-blue-200" data-mode="one_time">חד פעמית</button>
    <button type="button" class="mode-btn px-3 py-2 rounded-xl bg-gray-100 text-gray-400 border border-blue-200" data-mode="fixed">קבועה</button>
    <button type="button" class="mode-btn px-3 py-2 rounded-xl bg-gray-100 text-gray-400 border border-blue-200" data-mode="installments">תשלומים</button>
  </div>
</div>

<!-- שדות תשלומים (מופיעים רק כשנבחר "תשלומים") -->
<div id="installments-fields" class="grid grid-cols-2 gap-2 mt-2 hidden">
  <input type="number" id="installments_total" class="border rounded p-2" placeholder="סה״כ תשלומים" min="1">
  <input type="number" id="installments_left" class="border rounded p-2" placeholder="תשלומים נשארו" min="0">
</div>

<input type="hidden" id="expense_mode" value="one_time">
      <input type="hidden" name="category" id="category" required>
      <input type="date" id="date" class="border rounded p-2" required>
     <input type="number" id="amount"
       class="border rounded p-2"
       placeholder="Amount" required
       step="0.01" inputmode="decimal" min="0" />

      <input type="text" id="desc" class="border rounded p-2" placeholder="Description" required>
      <button class="bg-blue-500 text-white rounded py-2 hover:bg-blue-600" type="submit">Save</button>
      <button type="button" class="text-gray-500 underline" onclick="hideAddScreen()">Cancel</button>
    </form>
  </div>


  <!-- Loader Overlay -->
  
<div id="loader-overlay"
     class="fixed inset-0 bg-black bg-opacity-30 flex items-center justify-center z-50"
     style="display: none;">
  <div class="flex flex-col items-center">
    <div class="w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"></div>
    <div id="loader-message" class="mt-3 text-white text-sm px-4 text-center"></div>
  </div>
</div>


  <!-- כפתור ניווט קטן למסך הילדים -->
<button onclick="showScreen('kids')"
  class="fixed bottom-24 right-6 bg-amber-500 text-white rounded-full shadow px-4 py-2 z-30">
  💰 ילדים
</button>

<!-- מסך ילדים -->
<div id="screen-kids" class="fixed inset-0 bg-white z-40 p-4 overflow-y-auto" style="display:none;">
  <div class="flex justify-between items-center mb-3">
    <h2 class="text-lg font-bold">קופת ילדים</h2>
    <button class="text-blue-600 underline" onclick="hideKidsScreen()">סגור</button>
  </div>

  <div id="kids-grid" class="grid grid-cols-2 gap-3 mb-5">
    <!-- כרטיסי ילדים יוזרקו כאן -->
  </div>

  <div>
    <h3 class="font-semibold mb-2">יומן אחרון</h3>
    <ul id="kids-log" class="space-y-2"></ul>
  </div>
</div>
<!-- Kids Adjust Modal -->
<div id="kids-modal"
     class="fixed inset-0 z-50 hidden">
  <!-- רקע כהה -->
  <div class="absolute inset-0 bg-black/40" onclick="closeKidsModal()"></div>

  <!-- כרטיס תחתון (bottom sheet) -->
  <div class="absolute bottom-0 left-0 right-0 bg-white rounded-t-3xl p-4 shadow-lg">
    <div class="flex items-center justify-between mb-2">
      <div class="font-bold text-lg">
        עדכון קופה — <span id="kids-modal-name" class="text-blue-600"></span>
      </div>
      <button class="text-gray-400" onclick="closeKidsModal()">✕</button>
    </div>

    <!-- טוגל הוספה/הורדה -->
    <div class="flex justify-center gap-0 mb-3">
      <button type="button" id="kids-mode-add"
              class="px-5 py-2 rounded-l-xl font-bold bg-green-100 text-green-700 border border-green-200">
        הוספה
      </button>
      <button type="button" id="kids-mode-sub"
              class="px-5 py-2 rounded-r-xl font-bold bg-gray-100 text-gray-400 border border-green-200">
        הורדה
      </button>
    </div>

    <!-- טופס -->
    <div class="space-y-2">
      <div>
        <label class="text-sm text-gray-600">סכום (₪)</label>
        <input id="kids-amount" type="number" min="1" step="1"
               class="w-full border rounded-xl px-3 py-2" placeholder="לדוגמה: 50">
      </div>
      <div>
        <label class="text-sm text-gray-600">הערה (לא חובה)</label>
        <input id="kids-note" type="text"
               class="w-full border rounded-xl px-3 py-2" placeholder="לדוגמה: דמי כיס / קנית צעצוע">
      </div>
    </div>

    <!-- כפתורים -->
    <div class="flex gap-2 mt-4">
      <button class="flex-1 bg-gray-100 rounded-xl py-2" onclick="closeKidsModal()">ביטול</button>
      <button class="flex-1 bg-blue-600 text-white rounded-xl py-2" onclick="submitKidsAdjust()">שמור</button>
    </div>
  </div>
</div>

  </div>

  <script type="module" src="./js/config.js"></script>
  <script type="module" src="./js/auth.js"></script>
  <script type="module" src="./js/sheets.js"></script>
  <script type="module" src="./js/app-bridge.js"></script>
<script type="module" src="./js/old.js"></script>

  <!-- Then load your existing app JS (convert to module if you use imports) -->
  <!-- <script type="module" src="./js/your-existing-app.js"></script> -->
</body>
</html>
